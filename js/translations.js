// LYNCK Studio - Shared Translation System
// Centralized translations for all pages

const translations = {
  en: {
    // Navigation
    "Our Services": "Our Services",
    "About LYNCK": "About LYNCK",
    "Testimonials": "Testimonials",
    "Portfolio": "Portfolio",
    "Learning Platform": "Learning Platform",
    "Pricing": "Pricing",
    "All": "All",
    "Let's connect": "Let's connect",
    "Google Ads": "Google Ads",
    "Custom Website": "Custom Website",
    "Digital Products": "Digital Products",
    "Work": "Work",
    "About": "About",
    "Process": "Process",
    "Journal": "Journal",

    // Hero Section
    "Crafting digital marketing experiences that feel intuitive, look beautiful, and drive real results for companies like Apple, Tesla, and Stripe.": "Crafting digital marketing experiences that feel intuitive, look beautiful, and drive real results for companies like Apple, Tesla, and Stripe.",
    "View our work": "View our work",
    "About us": "About us",

    // Services
    "OUR SERVICES": "OUR SERVICES",
    "1. Easy-Edit Websites": "1. Easy-Edit Websites",
    "2. Google Ads Specialists": "2. Google Ads Specialists",
    "3. Learning Platform": "3. Learning Platform",
    "Easy-Edit Websites": "Easy-Edit Websites",
    "We consolidated three tools and shaved minutes off every task. Setup took under 10 minutes. Websites you can edit yourself - instantly. Change any text, image, or background in seconds. No technical knowledge required.": "We consolidated three tools and shaved minutes off every task. Setup took under 10 minutes. Websites you can edit yourself - instantly. Change any text, image, or background in seconds. No technical knowledge required.",
    "Google Ads Specialists": "Google Ads Specialists",
    "Learning Platform Access": "Learning Platform Access",
    "Learn More": "Learn More",
    "LEARNING PLATFORM": "LEARNING PLATFORM",
    "Master digital marketing with courses taught by proven professionals who deliver real results": "Master digital marketing with courses taught by proven professionals who deliver real results",
    "Start Your Learning Journey": "Start Your Learning Journey",
    "Join thousands of students who have transformed their careers with our expert-led courses": "Join thousands of students who have transformed their careers with our expert-led courses",
    "Access Learning Platform": "Access Learning Platform",
    "Free preview available • Premium courses from $97/month": "Free preview available • Premium courses from $97/month",
    "Course Topics": "Course Topics",
    "Comprehensive curriculum covering all aspects of digital marketing": "Comprehensive curriculum covering all aspects of digital marketing",
    "Google Ads Mastery": "Google Ads Mastery",
    "Complete Google Ads training from setup to optimization and scaling": "Complete Google Ads training from setup to optimization and scaling",
    "Analytics & Data": "Analytics & Data",
    "Learn to analyze data, create reports, and make data-driven decisions": "Learn to analyze data, create reports, and make data-driven decisions",
    "Website Development": "Website Development",
    "Build professional websites and landing pages that convert": "Build professional websites and landing pages that convert",
    "Social Media Marketing": "Social Media Marketing",
    "Master Facebook, Instagram, and LinkedIn advertising strategies": "Master Facebook, Instagram, and LinkedIn advertising strategies",
    "Content Strategy": "Content Strategy",
    "Create compelling content that engages audiences and drives conversions": "Create compelling content that engages audiences and drives conversions",
    "Business Strategy": "Business Strategy",
    "Develop comprehensive digital marketing strategies for business growth": "Develop comprehensive digital marketing strategies for business growth",
    "We focus on Google Ads with insider access to Google's latest features, beta programs, and insider knowledge. Managing campaigns for companies generating millions with 8-figure revenue experience.": "We focus on Google Ads with insider access to Google's latest features, beta programs, and insider knowledge. Managing campaigns for companies generating millions with 8-figure revenue experience.",
    "Google Ads Management": "Google Ads Management",
    "Beta feature access": "Beta feature access",
    "Million-dollar campaign experience": "Million-dollar campaign experience",
    "Direct Google support line": "Direct Google support line",
    "SEO That Actually Works with Your Ads": "SEO That Actually Works with Your Ads",
    "Google Analytics 4 setup and optimization. SEO strategy that complements your ad campaigns with data-driven insights.": "Google Analytics 4 setup and optimization. SEO strategy that complements your ad campaigns with data-driven insights.",
    "Google Analytics 4 setup": "Google Analytics 4 setup",
    "SEO strategy integration": "SEO strategy integration",
    "Data-driven insights": "Data-driven insights",
    "Performance tracking": "Performance tracking",

    // Testimonials
    "What Our Clients Say": "What Our Clients Say",
    "Real results from real partnerships": "Real results from real partnerships",

    // Footer
    "Let's create something amazing together": "Let's create something amazing together",
    "Ready to scale your marketing? We'd love to hear about your goals and explore how we can work together to achieve them.": "Ready to scale your marketing? We'd love to hear about your goals and explore how we can work together to achieve them.",
    "Quick Links": "Quick Links",
    "Connect With Us": "Connect With Us",
    "Services": "Services",
    "Contact Info": "Contact Info",

    // Contact Form
    "Get in touch with us": "Get in touch with us",
    "Ready to transform your digital presence? Let's discuss your project and see how we can help you achieve your goals.": "Ready to transform your digital presence? Let's discuss your project and see how we can work together to achieve your goals.",
    "First Name": "First Name",
    "Last Name": "Last Name",
    "Email Address": "Email Address",
    "Service Interested In": "Service Interested In",
    "Budget Range": "Budget Range",
    "How can LYNCK help you?": "How can LYNCK help you?",
    "Send Message": "Send Message",
    "Select a service": "Select a service",
    "Select budget range": "Select budget range",
    "Digital Marketing": "Digital Marketing",
    "Build a Website": "Build a Website",
    "Something Else": "Something Else",
    "Under $5,000": "Under $5,000",
    "$5,000 - $15,000": "$5,000 - $15,000",
    "$15,000 - $50,000": "$15,000 - $50,000",
    "$50,000+": "$50,000+"
  },
  de: {
    // Navigation
    "Our Services": "Unsere Dienstleistungen",
    "About LYNCK": "Über LYNCK",
    "Testimonials": "Referenzen",
    "Portfolio": "Portfolio",
    "Learning Platform": "Lernplattform",
    "Pricing": "Preise",
    "All": "Alle",
    "Let's connect": "Jetzt kontaktieren",
    "Google Ads": "Google Ads",
    "Custom Website": "Individuelle Website",
    "Digital Products": "Digitale Produkte",
    "Work": "Arbeit",
    "About": "Über",
    "Process": "Prozess",
    "Journal": "Journal",

    // Hero Section
    "Crafting digital marketing experiences that feel intuitive, look beautiful, and drive real results for companies like Apple, Tesla, and Stripe.": "Wir schaffen digitale Marketing-Erlebnisse, die intuitiv und schön sind und echte Ergebnisse für Unternehmen wie Apple, Tesla und Stripe erzielen.",
    "View our work": "Unsere Arbeit ansehen",
    "About us": "Über uns",

    // Services
    "OUR SERVICES": "UNSERE LEISTUNGEN",
    "1. Easy-Edit Websites": "1. Einfach Bearbeitbare Websites",
    "2. Google Ads Specialists": "2. Google Ads Spezialisten",
    "3. Learning Platform": "3. Lernplattform",
    "Easy-Edit Websites": "Einfach Bearbeitbare Websites",
    "We consolidated three tools and shaved minutes off every task. Setup took under 10 minutes. Websites you can edit yourself - instantly. Change any text, image, or background in seconds. No technical knowledge required.": "Wir haben drei Tools konsolidiert und Minuten von jeder Aufgabe eingespart. Die Einrichtung dauerte unter 10 Minuten. Websites, die Sie selbst bearbeiten können - sofort. Ändern Sie jeden Text, jedes Bild oder jeden Hintergrund in Sekunden. Keine technischen Kenntnisse erforderlich.",
    "Google Ads Specialists": "Google Ads Spezialisten",
    "Learning Platform Access": "Zugang zur Lernplattform",
    "Learn More": "Mehr Erfahren",
    "LEARNING PLATFORM": "Lern-\nplattform",
    "Master digital marketing with courses taught by proven professionals who deliver real results": "Meistern Sie digitales Marketing mit Kursen von bewährten Profis, die echte Ergebnisse liefern",
    "Start Your Learning Journey": "Starten Sie Ihre Lernreise",
    "Join thousands of students who have transformed their careers with our expert-led courses": "Schließen Sie sich Tausenden von Studenten an, die ihre Karriere mit unseren expertengeleiteten Kursen transformiert haben",
    "Access Learning Platform": "Zugang zur Lernplattform",
    "Free preview available • Premium courses from $97/month": "Kostenlose Vorschau verfügbar • Premium-Kurse ab 97 $/Monat",
    "Course Topics": "Kursthemen",
    "Comprehensive curriculum covering all aspects of digital marketing": "Umfassendes Curriculum, das alle Aspekte des digitalen Marketings abdeckt",
    "Google Ads Mastery": "Google Ads Meisterschaft",
    "Complete Google Ads training from setup to optimization and scaling": "Vollständiges Google Ads Training von der Einrichtung bis zur Optimierung und Skalierung",
    "Analytics & Data": "Analytik & Daten",
    "Learn to analyze data, create reports, and make data-driven decisions": "Lernen Sie Daten zu analysieren, Berichte zu erstellen und datengesteuerte Entscheidungen zu treffen",
    "Website Development": "Website-Entwicklung",
    "Build professional websites and landing pages that convert": "Erstellen Sie professionelle Websites und Landingpages, die konvertieren",
    "Social Media Marketing": "Social Media Marketing",
    "Master Facebook, Instagram, and LinkedIn advertising strategies": "Meistern Sie Facebook-, Instagram- und LinkedIn-Werbestrategien",
    "Content Strategy": "Content-Strategie",
    "Create compelling content that engages audiences and drives conversions": "Erstellen Sie ansprechende Inhalte, die Ihr Publikum begeistern und Conversions fördern",
    "Business Strategy": "Geschäftsstrategie",
    "Develop comprehensive digital marketing strategies for business growth": "Entwickeln Sie umfassende digitale Marketingstrategien für Geschäftswachstum",
    "We focus on Google Ads with insider access to Google's latest features, beta programs, and insider knowledge. Managing campaigns for companies generating millions with 8-figure revenue experience.": "Wir konzentrieren uns auf Google Ads mit Insider-Zugang zu Googles neuesten Funktionen, Beta-Programmen und Insider-Wissen. Verwaltung von Kampagnen für Unternehmen, die Millionen generieren mit 8-stelliger Umsatzerfahrung.",
    "Google Ads Management": "Google Ads Verwaltung",
    "Beta feature access": "Beta-Feature-Zugang",
    "Million-dollar campaign experience": "Millionen-Dollar-Kampagnen-Erfahrung",
    "Direct Google support line": "Direkte Google-Support-Linie",
    "SEO That Actually Works with Your Ads": "SEO Das Tatsächlich Mit Ihren Anzeigen Funktioniert",
    "Google Analytics 4 setup and optimization. SEO strategy that complements your ad campaigns with data-driven insights.": "Google Analytics 4 Einrichtung und Optimierung. SEO-Strategie, die Ihre Anzeigenkampagnen mit datengesteuerten Erkenntnissen ergänzt.",
    "Google Analytics 4 setup": "Google Analytics 4 Einrichtung",
    "SEO strategy integration": "SEO-Strategie-Integration",
    "Data-driven insights": "Datengesteuerte Erkenntnisse",
    "Performance tracking": "Leistungsverfolgung",

    // Testimonials
    "What Our Clients Say": "Was Unsere Kunden Sagen",
    "Real results from real partnerships": "Echte Ergebnisse aus echten Partnerschaften",

    // Footer
    "Let's create something amazing together": "Lassen Sie uns gemeinsam etwas Erstaunliches schaffen",
    "Ready to scale your marketing? We'd love to hear about your goals and explore how we can work together to achieve them.": "Bereit, Ihr Marketing zu skalieren? Wir würden gerne von Ihren Zielen hören und erkunden, wie wir zusammenarbeiten können, um sie zu erreichen.",
    "Quick Links": "Schnelle Links",
    "Connect With Us": "Verbinden Sie Sich Mit Uns",
    "Services": "Dienstleistungen",
    "Contact Info": "Kontakt Info",

    // Contact Form
    "Get in touch with us": "Kontaktieren Sie uns",
    "Ready to transform your digital presence? Let's discuss your project and see how we can help you achieve your goals.": "Bereit, Ihre digitale Präsenz zu transformieren? Lassen Sie uns Ihr Projekt besprechen und sehen, wie wir Ihnen helfen können, Ihre Ziele zu erreichen.",
    "First Name": "Vorname",
    "Last Name": "Nachname",
    "Email Address": "E-Mail-Adresse",
    "Service Interested In": "Interessierter Service",
    "Budget Range": "Budget-Bereich",
    "How can LYNCK help you?": "Wie kann LYNCK Ihnen helfen?",
    "Send Message": "Nachricht Senden",
    "Select a service": "Service auswählen",
    "Select budget range": "Budget-Bereich auswählen",
    "Digital Marketing": "Digitales Marketing",
    "Build a Website": "Website Erstellen",
    "Something Else": "Etwas Anderes",
    "Under $5,000": "Unter $5.000",
    "$5,000 - $15,000": "$5.000 - $15.000",
    "$15,000 - $50,000": "$15.000 - $50.000",
    "$50,000+": "$50.000+"
  },
};

// Shared translation functionality
const routing = typeof window !== 'undefined' ? (window.__lynckRouting || null) : null;

const supportedLanguages = (routing?.SUPPORTED_LANGS || ['en', 'de']).map(lang => String(lang).toLowerCase());

const fallbackLocalizedRoutes = {
  index: {
    en: '',
    de: 'de/index.html'
  },
  'google-ads': {
    en: 'google-ads.html',
    de: 'de/google-ads.html'
  },
  pricing: {
    en: 'pricing.html',
    de: 'pricing.html'
  },
  'custom-website': {
    en: 'custom-website.html',
    de: 'de/custom-website.html'
  },
  'digital-products': {
    en: 'digital-products.html',
    de: 'de/digital-products.html'
  },
  'learning-platform': {
    en: 'learning-platform.html',
    de: 'de/learning-platform.html'
  },
  portfolio: {
    en: 'portfolio.html',
    de: 'de/portfolio.html'
  },
  'why-choose-us': {
    en: 'why-choose-us.html',
    de: 'de/why-choose-us.html'
  }
};

const localizedRoutes = routing?.ROUTE_MAP || fallbackLocalizedRoutes;

function fallbackNormalizeLang(lang) {
  if (typeof lang !== 'string') return 'en';
  const normalized = lang.toLowerCase();
  return supportedLanguages.includes(normalized) ? normalized : 'en';
}

const normalizeLang = routing?.normalizeLang || fallbackNormalizeLang;

function fallbackGetPathSegments(pathname) {
  if (typeof pathname !== 'string') return [];
  return pathname.split('/').filter(Boolean);
}

function fallbackSplitWithoutLocale(segments) {
  if (!segments.length) {
    return { baseSegments: [], pageSegments: [] };
  }

  const last = segments[segments.length - 1];
  if (last && last.includes('.')) {
    return {
      baseSegments: segments.slice(0, -1),
      pageSegments: segments.slice(-1)
    };
  }

  return { baseSegments: segments, pageSegments: [] };
}

function fallbackDeriveSlug(pageSegments) {
  if (!pageSegments.length) {
    return 'index';
  }

  const last = pageSegments[pageSegments.length - 1];
  if (!last || last === '' || /index\.html?$/i.test(last)) {
    return 'index';
  }

  if (last.includes('.')) {
    return last.replace(/\.html?$/i, '') || 'index';
  }

  return last;
}

function fallbackGetPathInfo(pathname) {
  const segments = fallbackGetPathSegments(pathname);
  const localeIndex = segments.findIndex(seg => supportedLanguages.includes(seg.toLowerCase()));

  let baseSegments = [];
  let pageSegments = [];
  let locale = null;

  if (localeIndex !== -1) {
    locale = segments[localeIndex].toLowerCase();
    baseSegments = segments.slice(0, localeIndex);
    pageSegments = segments.slice(localeIndex + 1);
  } else {
    const split = fallbackSplitWithoutLocale(segments);
    baseSegments = split.baseSegments;
    pageSegments = split.pageSegments;
  }

  const slug = fallbackDeriveSlug(pageSegments);
  const basePath = baseSegments.length ? `/${baseSegments.join('/')}` : '';

  return {
    basePath,
    locale,
    pageSegments,
    slug
  };
}

function getPathInfo(pathname) {
  if (routing && typeof routing.getPathInfo === 'function') {
    return routing.getPathInfo(pathname);
  }
  return fallbackGetPathInfo(pathname);
}

function fallbackJoinPath(basePath, target) {
  const normalizedBase = basePath ? basePath.replace(/\/+$/, '') : '';
  const normalizedTarget = target ? String(target).replace(/^\/+/, '') : '';

  if (!normalizedTarget) {
    return normalizedBase ? `${normalizedBase}/` : '/';
  }

  if (!normalizedBase) {
    return `/${normalizedTarget}`;
  }

  return `${normalizedBase}/${normalizedTarget}`;
}

function fallbackBuildRelativeFallback(info, lang) {
  const normalizedLang = normalizeLang(lang);
  const lastSegment = info.pageSegments.length ? info.pageSegments[info.pageSegments.length - 1] : '';
  const fileName = lastSegment && lastSegment.includes('.') ? lastSegment : (info.slug === 'index' ? 'index.html' : `${info.slug}.html`);

  if (normalizedLang === 'en') {
    if (info.slug === 'index') {
      return '';
    }
    return fileName;
  }

  if (info.slug === 'index') {
    return `${normalizedLang}/`;
  }

  return `${normalizedLang}/${fileName}`;
}

function normalizePathForCompare(path) {
  if (typeof path !== 'string' || path === '') {
    return '/';
  }
  return path === '/' ? '/' : path.replace(/\/+$/, '');
}

function detectLanguageFromPath() {
  if (routing && typeof routing.detectLanguageFromPath === 'function') {
    return routing.detectLanguageFromPath();
  }
  const info = getPathInfo(window.location.pathname);
  return info.locale && supportedLanguages.includes(info.locale) ? info.locale : 'en';
}

function getStoredLanguage() {
  try {
    const stored = localStorage.getItem('language');
    if (stored) {
      return normalizeLang(stored);
    }
  } catch (error) {
    console.warn('Unable to access localStorage for language preference:', error);
  }
  return null;
}

function setStoredLanguage(lang) {
  try {
    localStorage.setItem('language', normalizeLang(lang));
  } catch (error) {
    console.warn('Unable to persist language preference:', error);
  }
}

function syncNavigationLanguage(lang) {
  const normalizedLang = normalizeLang(lang);
  if (typeof window !== 'undefined' && typeof window.__lynckApplyLocalizedLinks === 'function') {
    window.__lynckApplyLocalizedLinks(normalizedLang);
  }
}

const storedLanguage = getStoredLanguage();
const pathLanguage = detectLanguageFromPath();

// Priority: path language > stored language > default 'en'
// If we're on a German page (/de/...), always use German
// If we're on an English page and have no stored preference, use English
// Use explicit check for path language to avoid empty string issues
let currentLanguage = (pathLanguage && supportedLanguages.includes(pathLanguage))
  ? pathLanguage
  : (storedLanguage || 'en');

// Store the language preference
if (currentLanguage !== storedLanguage) {
  setStoredLanguage(currentLanguage);
}

syncNavigationLanguage(currentLanguage);

function resolveLocalizedPath(lang) {
  if (routing && typeof routing.resolveLocalizedPath === 'function') {
    return routing.resolveLocalizedPath(lang);
  }

  try {
    const info = getPathInfo(window.location.pathname);
    const normalizedLang = normalizeLang(lang);
    const route = localizedRoutes[info.slug];
    let relativeTarget = route ? (route[normalizedLang] || route.en) : null;

    if (!relativeTarget) {
      relativeTarget = fallbackBuildRelativeFallback(info, normalizedLang);
    }

    if (!relativeTarget) {
      return null;
    }

    return fallbackJoinPath(info.basePath, relativeTarget);
  } catch (error) {
    console.warn('resolveLocalizedPath error:', error);
  }
  return null;
}

function translateElement(element) {
  const key = element.getAttribute('data-translate');
  if (key && translations[currentLanguage] && translations[currentLanguage][key]) {
    element.textContent = translations[currentLanguage][key];
  }
}

function translatePage() {
  const elements = document.querySelectorAll('[data-translate]');
  elements.forEach(translateElement);
}

function setLanguage(lang) {
  const normalizedLang = normalizeLang(lang);
  currentLanguage = normalizedLang;
  setStoredLanguage(normalizedLang);

  syncNavigationLanguage(normalizedLang);

  const redirectedPath = resolveLocalizedPath(normalizedLang);
  if (redirectedPath) {
    const normalizedTarget = normalizePathForCompare(redirectedPath);
    const normalizedCurrent = normalizePathForCompare(window.location.pathname);

    if (normalizedTarget !== normalizedCurrent) {
      const hash = window.location.hash || '';
      window.location.href = `${redirectedPath}${hash}`;
      return;
    } else if (window.location.hash) {
      window.location.href = `${redirectedPath}${window.location.hash}`;
      return;
    }
  }

  translatePage();

  // Update language button text
  const langButton = document.getElementById('currentLang');
  if (langButton) {
    const langMap = { en: 'EN', de: 'DE' };
    langButton.textContent = langMap[normalizedLang] || 'EN';
  }
}

// Initialize translations when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  translatePage();

  // Update language button
  const langButton = document.getElementById('currentLang');
  if (langButton) {
    const langMap = { en: 'EN', de: 'DE' };
    langButton.textContent = langMap[currentLanguage] || 'EN';
  }

  syncNavigationLanguage(currentLanguage);
});

// Export for global access
if (typeof window !== 'undefined') {
  window.translations = translations;
  window.setLanguage = setLanguage;
  window.translatePage = translatePage;
}
